<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moqataa (Boycott) - مقاطعة</title>
    <meta property="og:title" content="Moqataa (Boycott) - مقاطعة" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://moqataa.com" />
    <meta property="og:image" content="/assets/moqataa.png" />
    <meta name="twitter:card" content="summary" />
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light py-5">

<div class="container">
    <div class="row justify-content-center mb-4">
        <div class="col-md-8 text-center">
            <img src="/assets/moqataa.png" width="150" height="150" alt="Site Logo" class="mb-2">
            <h1>Moqataa (Boycott) - مقاطعة</h1>
            <p class="text-muted">Do your part by boycotting companies that support Israel and their continued oppression against the Palestinian people.</p>
            <p class="text-muted">قم بدورك بمقاطعة الشركات التي تدعم إسرائيل وقمعها المستمر ضد الشعب الفلسطيني.</p>
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-md-10">
            <input type="text" id="searchInput" class="form-control" placeholder="Search companies..." oninput="search()">
        </div>
    </div>

    <div class="row justify-content-center mt-3">
        <div class="col-md-10">
            <table id="results" class="table table-striped">
                <thead>
                <tr>
                    <th>Photo</th>
                    <th>Name</th>
<!--                    <th class="d-none d-md-table-cell">URL</th>-->
                    <th class="d-none d-md-table-cell">Category</th>
<!--                    <th class="d-none d-md-table-cell">Country</th>-->
                    <th>Reason</th>
                    <th class="d-none d-md-table-cell">Reason URL</th>
                </tr>
                </thead>
                <tbody>
                <!-- Results will be displayed here -->
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    let csvData = '';

    fetch('https://raw.githubusercontent.com/moqataa-root/boycott-data/main/companies.csv')
        .then(response => response.text())
        .then(data => {
            csvData = data;
            search(); // Call search after fetching to display all results initially
        });

    function parseCSV(data) {
        const lines = data.trim().split("\n");
        const headers = lines[0].split(",");
        const results = [];

        for(let i = 1; i < lines.length; i++) {
            const obj = {};
            const currentLine = lines[i].split(",");

            for(let j = 0; j < headers.length; j++) {
                obj[headers[j].trim()] = currentLine[j].trim();
            }
            results.push(obj);
        }
        return results;
    }

    function search() {
        const searchTerm = document.getElementById("searchInput").value.toLowerCase();
        const parsedData = parseCSV(csvData);
        let html = '';

        for(let i = 0; i < parsedData.length; i++) {
            const dataString = JSON.stringify(parsedData[i]).toLowerCase();

            if (dataString.includes(searchTerm)) {
                html += `<tr>
                    <td><img src="${parsedData[i]['photo']}" alt="${parsedData[i]['name']}'s photo" class="rounded-circle" width="50"></td>
                    <td>${parsedData[i]['name']}</td>
<!--                    <td class="d-none d-md-table-cell"><a href="${parsedData[i]['url']}" target="_blank">${parsedData[i]['url']}</a></td>-->
                    <td class="d-none d-md-table-cell">${parsedData[i]['category']}</td>
<!--                    <td class="d-none d-md-table-cell">${parsedData[i]['country']}</td>-->
                    <td>${parsedData[i]['reason']}</td>
                    <td class="d-none d-md-table-cell"><a href="${parsedData[i]['reason_url']}" target="_blank">${parsedData[i]['reason_url']}</a></td>
                </tr>`;
            }
        }
        document.querySelector("#results tbody").innerHTML = html;
    }
</script>

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>
